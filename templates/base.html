{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}OSMS{% endblock %}</title>
    <!-- Local Bootstrap CSS -->
    <link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet">
    <!-- Custom CSS -->
    <link href="{% static 'css/custom.css' %}" rel="stylesheet">
    {% block extra_css %}{% endblock %}
</head>
<body>
    <div class="wrapper d-flex align-items-stretch">
        {% if user.is_authenticated %}
        <!-- Sidebar -->
        <nav id="sidebar">
            <div class="sidebar-header">
                <h3>OSMS</h3>
            </div>

            <ul class="list-unstyled components">
                <li class="{% if request.resolver_match.url_name == 'home' %}active{% endif %}">
                    <a href="{% url 'home' %}">Dashboard</a>
                </li>

                {% if user.role == 'Admin' or user.role == 'Principal' or user.role == 'Clerk' %}
                <li>
                    <a href="#studentSubmenu" data-bs-toggle="collapse" aria-expanded="false" class="dropdown-toggle">Students</a>
                    <ul class="collapse list-unstyled {% if 'student' in request.path %}show{% endif %}" id="studentSubmenu">
                        <li class="{% if request.resolver_match.url_name == 'student_list' %}active{% endif %}">
                            <a href="{% url 'student_list' %}">View Students</a>
                        </li>
                        <li class="{% if request.resolver_match.url_name == 'student_registration' %}active{% endif %}">
                            <a href="{% url 'student_registration' %}">Register Student</a>
                        </li>
                        <li class="{% if request.resolver_match.url_name == 'student_bulk_import' %}active{% endif %}">
                            <a href="{% url 'student_bulk_import' %}">Bulk Import</a>
                        </li>
                    </ul>
                </li>
                {% endif %}

                {% if user.role == 'Admin' or user.role == 'Principal' %}
                <li>
                    <a href="#academicSubmenu" data-bs-toggle="collapse" aria-expanded="false" class="dropdown-toggle">Academics</a>
                    <ul class="collapse list-unstyled {% if 'teacher' in request.path or 'course' in request.path %}show{% endif %}" id="academicSubmenu">
                        <li class="{% if request.resolver_match.url_name == 'teacher_list' %}active{% endif %}">
                            <a href="{% url 'teacher_list' %}">View Teachers</a>
                        </li>
                        <li class="{% if request.resolver_match.url_name == 'teacher_registration' %}active{% endif %}">
                            <a href="{% url 'teacher_registration' %}">Register Teacher</a>
                        </li>
                        <li class="{% if request.resolver_match.url_name == 'course_list' %}active{% endif %}">
                            <a href="{% url 'course_list' %}">View Courses</a>
                        </li>
                        <li class="{% if request.resolver_match.url_name == 'course_creation' %}active{% endif %}">
                            <a href="{% url 'course_creation' %}">Create Course</a>
                        </li>
                        <li class="{% if request.resolver_match.url_name == 'teacher_assignment' %}active{% endif %}">
                            <a href="{% url 'teacher_assignment' %}">Assign Teacher</a>
                        </li>
                    </ul>
                </li>
                {% endif %}

                {% if user.role == 'Admin' or user.role == 'Principal' or user.role == 'Teacher' or user.role == 'Clerk' %}
                <li>
                    <a href="#enrollSubmenu" data-bs-toggle="collapse" aria-expanded="false" class="dropdown-toggle">Enrollment</a>
                    <ul class="collapse list-unstyled {% if 'enroll' in request.path %}show{% endif %}" id="enrollSubmenu">
                        <li class="{% if request.resolver_match.url_name == 'enrollment' %}active{% endif %}">
                            <a href="{% url 'enrollment' %}">Individual Enrollment</a>
                        </li>
                        <li class="{% if request.resolver_match.url_name == 'bulk_enrollment' %}active{% endif %}">
                            <a href="{% url 'bulk_enrollment' %}">Bulk Enrollment</a>
                        </li>
                    </ul>
                </li>
                {% endif %}

                {% if user.role == 'Admin' or user.role == 'Principal' or user.role == 'Teacher' %}
                <li>
                    <a href="#attendanceSubmenu" data-bs-toggle="collapse" aria-expanded="false" class="dropdown-toggle">Attendance</a>
                    <ul class="collapse list-unstyled {% if 'attendance' in request.path %}show{% endif %}" id="attendanceSubmenu">
                        <li class="{% if request.resolver_match.url_name == 'attendance' %}active{% endif %}">
                            <a href="{% url 'attendance' %}">Single Entry</a>
                        </li>
                        <li class="{% if request.resolver_match.url_name == 'bulk_attendance' %}active{% endif %}">
                            <a href="{% url 'bulk_attendance' %}">Bulk Entry</a>
                        </li>
                    </ul>
                </li>
                <li class="{% if request.resolver_match.url_name == 'record_grade' %}active{% endif %}">
                    <a href="{% url 'record_grade' %}">Exams & Grades</a>
                </li>
                {% endif %}

                {% if user.role == 'Admin' or user.role == 'Principal' or user.role == 'Teacher' %}
                <li>
                    <a href="#reportsSubmenu" data-bs-toggle="collapse" aria-expanded="false" class="dropdown-toggle">Reports</a>
                    <ul class="collapse list-unstyled {% if 'report' in request.path %}show{% endif %}" id="reportsSubmenu">
                        <li class="{% if request.resolver_match.url_name == 'student_attendance_report' %}active{% endif %}">
                            <a href="{% url 'student_attendance_report' %}">Attendance: Student</a>
                        </li>
                        <li class="{% if request.resolver_match.url_name == 'class_attendance_report' %}active{% endif %}">
                            <a href="{% url 'class_attendance_report' %}">Attendance: Class</a>
                        </li>
                    </ul>
                </li>
                {% endif %}

                {% if user.role == 'Admin' or user.role == 'Accountant' %}
                <li>
                    <a href="#financeSubmenu" data-bs-toggle="collapse" aria-expanded="false" class="dropdown-toggle">Finance</a>
                    <ul class="collapse list-unstyled {% if 'finance' in request.path or 'payment' in request.path %}show{% endif %}" id="financeSubmenu">
                        <li class="{% if request.resolver_match.url_name == 'payment_list' %}active{% endif %}">
                            <a href="{% url 'payment_list' %}">Payment Records</a>
                        </li>
                        <li class="{% if request.resolver_match.url_name == 'record_payment' %}active{% endif %}">
                            <a href="{% url 'record_payment' %}">Record Payment</a>
                        </li>
                    </ul>
                </li>
                {% endif %}

                {% if user.is_staff %}
                <li>
                    <a href="/admin">System Settings</a>
                </li>
                {% endif %}
            </ul>
        </nav>
        {% endif %}

        <!-- Page Content  -->
        <div id="content" {% if not user.is_authenticated %}style="margin-left: 0; width: 100%;"{% endif %}>
            <header class="topbar">
                <h5 class="m-0 text-primary fw-bold">Offline School Management System</h5>

                {% if user.is_authenticated %}
                <div class="user-info d-flex align-items-center">
                    <span class="me-3 text-muted">{{ user.username }} ({{ user.role }})</span>
                    <form method="post" action="{% url 'logout' %}" class="m-0">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-sm btn-outline-danger">Logout</button>
                    </form>
                </div>
                {% else %}
                <div class="user-info">
                    <a href="{% url 'login' %}" class="btn btn-sm btn-primary">Login</a>
                </div>
                {% endif %}
            </header>

            <div class="container-fluid">
                {% if messages %}
                    {% for message in messages %}
                        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                            {{ message }}
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>
                    {% endfor %}
                {% endif %}

                {% block content %}
                {% endblock %}
            </div>
        </div>
    </div>

    <!-- Local Bootstrap JS Bundle -->
    <script src="{% static 'js/bootstrap.bundle.min.js' %}"></script>
    {% block extra_js %}{% endblock %}
</body>
</html>
